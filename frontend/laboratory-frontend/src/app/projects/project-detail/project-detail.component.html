<div class="project-detail-container">
  <mat-progress-bar *ngIf="isLoading" mode="indeterminate"></mat-progress-bar>

  <div *ngIf="project" class="project-content">
    <div class="header">
      <div class="title-section">
        <h1>{{project.title}}</h1>
        <mat-chip-set>
          <mat-chip [color]="project.status === 'ongoing' ? 'accent' : 'primary'" selected>
            {{project.status | titlecase}}
          </mat-chip>
        </mat-chip-set>
      </div>
      
      <button mat-raised-button color="primary" routerLink="/projects">
        <mat-icon>arrow_back</mat-icon>
        Back to Projects
      </button>
    </div>

    <div class="info-grid">
      <mat-card class="summary-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>description</mat-icon>
          <mat-card-title>Project Summary</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <p>{{project.summary}}</p>
        </mat-card-content>
      </mat-card>

      <mat-card class="timeline-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>schedule</mat-icon>
          <mat-card-title>Timeline</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="timeline-info">
            <div class="date-item">
              <strong>Start Date:</strong>
              <span>{{project.startDate | date:'mediumDate'}}</span>
            </div>
            <div class="date-item">
              <strong>End Date:</strong>
              <span>{{project.endDate | date:'mediumDate'}}</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="members-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>people</mat-icon>
          <mat-card-title>Team Members</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <mat-chip-set>
            <mat-chip *ngFor="let member of project.members" class="member-chip">
              <mat-icon>person</mat-icon>
              {{member.firstName}} {{member.lastName}}
            </mat-chip>
          </mat-chip-set>
        </mat-card-content>
      </mat-card>

      <mat-card class="results-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>insights</mat-icon>
          <mat-card-title>Expected Results</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <p>{{project.expectedResults || 'No expected results specified'}}</p>
        </mat-card-content>
      </mat-card>
    </div>

    <mat-card class="documents-card">
      <mat-card-header>
        <div class="header-content">
          <div class="header-title">
            <mat-icon mat-card-avatar>folder</mat-icon>
            <mat-card-title>Project Documents</mat-card-title>
          </div>
          <button *ngIf="canUploadDocument" 
                  mat-raised-button 
                  color="accent" 
                  (click)="openUploadDialog()">
            <mat-icon>upload</mat-icon>
            Upload Project Files
          </button>
        </div>
      </mat-card-header>
      
      <mat-card-content>
        <div *ngIf="project.documents && project.documents.length > 0">
          <div class="documents-list">
            <div *ngFor="let doc of project.documents" class="document-item">
              <!-- Icône du document basée sur le type -->
              <div class="document-icon">
                <mat-icon [ngClass]="getDocumentIconClass(doc.title)">
                  {{getDocumentIcon(doc.title)}}
                </mat-icon>
              </div>
              
              <!-- Informations du document -->
              <div class="document-info">
                <div class="document-title">{{doc.title}}</div>
                <div class="document-details">
                  Uploaded: {{doc.uploadDate | date:'short'}} • {{getFileType(doc.title)}}
                </div>
              </div>
              
              <!-- Boutons d'action -->
              <div class="document-actions">
                <!-- Bouton Delete - visible seulement pour membres du projet et admin -->
                <button *ngIf="canDeleteDocument" 
                        mat-icon-button 
                        color="warn" 
                        (click)="deleteDocument(doc._id, doc.title)"
                        matTooltip="Delete Document">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <div *ngIf="!project.documents || project.documents.length === 0" class="no-docs">
          <mat-icon>folder_open</mat-icon>
          <p>No documents available</p>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Upload Dialog -->
  <div *ngIf="showUploadDialog" class="upload-overlay" (click)="closeUploadDialog()">
    <div class="upload-dialog" (click)="$event.stopPropagation()">
      <h3>Upload Project Document</h3>
      
      <mat-form-field appearance="outline">
        <mat-label>Document Title</mat-label>
        <input matInput [(ngModel)]="documentTitle" placeholder="Enter document title">
      </mat-form-field>

      <div class="file-upload">
        <input #fileInput 
               type="file" 
               (change)="onFileSelected($event)" 
               accept=".pdf,.doc,.docx"
               style="display: none;">
        
        <button mat-stroked-button (click)="fileInput.click()">
          <mat-icon>attach_file</mat-icon>
          Choose File
        </button>
        
        <div *ngIf="selectedFile" class="file-info">
          <div class="file-details">
            <mat-icon [ngClass]="getDocumentIconClass(selectedFile.name)">
              {{getDocumentIcon(selectedFile.name)}}
            </mat-icon>
            <span class="file-name">{{selectedFile.name}}</span>
            <span class="file-size">({{formatFileSize(selectedFile.size)}})</span>
          </div>
        </div>
        
        <div *ngIf="!selectedFile" class="file-hint">
          <small>Accepted formats: PDF, DOC, DOCX (Max 10MB)</small>
        </div>
      </div>

      <div class="dialog-actions">
        <button mat-button (click)="closeUploadDialog()">Cancel</button>
        <button mat-raised-button 
                color="primary" 
                [disabled]="!selectedFile || uploadInProgress"
                (click)="uploadDocument()">
          {{uploadInProgress ? 'Uploading...' : 'Upload'}}
        </button>
      </div>
    </div>
  </div>
</div>